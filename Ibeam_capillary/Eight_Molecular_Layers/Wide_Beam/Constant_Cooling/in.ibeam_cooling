# read data from wall
# read data from water cylinder
# save new configuration





variable            SEED string 18580
variable            NAME string ibeam_cooling_0
variable            DIR string run_0
variable            PRES string 1
variable            START_TEMP string 235
variable            END_TEMP string 225
variable            STEPS string 4000000
variable            TCOUPL string 5000.0
variable            PCOUPL string 10000.0
variable            TDAMP string 1000.0
variable            PDAMP string 2500.0

units	   	    real
atom_style 	    atomic
log		    ${DIR}/log.eq_${NAME}


### IMPORT ATOMS ###
read_data ../Box_Setup/data.Ibeam_240K
group water type 2
group graphite type 1


# Define potential
#
pair_style          sw
pair_coeff * * MLC_e.sw C mW

# Add velocity/set timestep
#

fix		1 graphite setforce 0.0 0.0 0.0
velocity 	graphite set 0.0 0.0 0.0
velocity            water create ${START_TEMP} ${SEED} rot yes dist gaussian
timestep            5.0

# Define output
#
compute 1 water msd
compute 2 water temp


thermo	            100
thermo_style custom step c_2 press vol etotal ke pe c_1[4] density

# Neighbor lists
#
neigh_modify        delay 0 every 1 check yes


# Set fixes
#
fix                 2 water momentum 10 linear 1 1 1 rescale
fix                 3 all nve
fix                 4 water temp/csvr ${START_TEMP} ${START_TEMP} 500.0 928347

# Run 0.05 ns equilibration
#
dump                1 all custom 100 ${DIR}/eq.${NAME}.dump id type x y z vx vy vz
run                 10000
write_data 	    ${DIR}/data.${NAME}_eq

undump              1
unfix               4



################################################
#######         Run Simulation         #########
################################################  

reset_timestep      0
timestep	    10.0
log                 ${DIR}/log.run_${NAME}

# Set production fixes - Nose/Hoover
#
fix                 4 water temp/csvr ${START_TEMP} ${END_TEMP} 500.0 928347


## divide "droplet" into core and surface
#region		core_reg cylinder z 135 135 44.6 20 INF units box
#region		surface_reg cylinder z 135 135 44.6 20 INF units box side out
#group		core dynamic all region core_reg
#group		surface dynamic all region surface_reg

## compute pressure core
#compute        peratom_core core stress/atom NULL
#compute        p_core core reduce sum c_peratom_core[1] c_peratom_core[2] c_peratom_core[3]
#variable       press_core equal -(c_p_core[1]+c_p_core[2]+c_p_core[3])/(3*1249982.5)


## compute pressure surface
#compute        peratom_surf surface stress/atom NULL
#compute        p_surf surface reduce sum c_peratom_surf[1] c_peratom_surf[2] #c_peratom_surf[3]
#variable       press_surf equal -(c_p_surf[1]+c_p_surf[2]+c_p_surf[3])/(3*42395)

## compute total pressure of drop
compute        peratom water stress/atom NULL
compute        p water reduce sum c_peratom[1] c_peratom[2] c_peratom[3]
variable       press equal -(c_p[1]+c_p[2]+c_p[3])/(3*50320)


# compute order parameter
compute        3 all orientorder/atom nnn NULL cutoff 3.5

# compute center of mass of bridge
compute 	4 water com

# Run simulation
thermo_style        custom step c_2 press vol etotal ke pe v_press c_1[4] c_4[*]
thermo              200
dump		     1 water custom 400 ${DIR}/prod.${NAME}.dump id type x y z vx vy vz c_3[*] c_peratom[*]
run                 ${STEPS}
write_data 		${DIR}/data.${NAME}_run
